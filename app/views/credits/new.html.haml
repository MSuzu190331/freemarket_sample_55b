.buy-content
  %header.buy-content__header
    %h1
      = link_to "https://www.mercari.com/jp/" do
        = image_tag "https://www-mercari-jp.akamaized.net/assets/img/common/common/logo.svg?2098311808", alt:"mercari"
  .reg-container__main
    .reg-container__main--content
      %h2.reg-container__main--content-title 支払い方法
      =form_with url: credits_path, method: :post do |f|
        .reg-container__main--content-title--input
          .input-groups
            .input-group
              %label カード番号
              %span.red-box 必須
              =f.text_field:payjp_id, placeholder: "半角数字のみ", class: "input-def"
              %ul
                %li
                  = image_tag "//www-mercari-jp.akamaized.net/assets/img/card/visa.svg?863303983", class:"card-image"
                  = image_tag "//www-mercari-jp.akamaized.net/assets/img/card/master-card.svg?863303983", class:"card-image"
                  = image_tag "//www-mercari-jp.akamaized.net/assets/img/card/saison-card.svg?863303983", class:"card-image"
                  = image_tag "//www-mercari-jp.akamaized.net/assets/img/card/jcb.svg?863303983", class:"card-image"
                  = image_tag "//www-mercari-jp.akamaized.net/assets/img/card/american_express.svg?863303983", class:"card-image"
                  = image_tag "//www-mercari-jp.akamaized.net/assets/img/card/dinersclub.svg?863303983", class:"card-image"
                  = image_tag "//www-mercari-jp.akamaized.net/assets/img/card/discover.svg?863303983", class:"card-image"
            .input-group
              %label 有効期限
              %span.red-box 必須
              %br
              = f.select:exp_month, [["--", 0],["01",1],["02",2],["03",3],["04",4],["05",5],["06",6],["07",7],["08",8],["09",9],["10",10],["11",11],["12",12]],{} , class: 'input-expire'
              %span 月
              %br
              = f.select:exp_year, [["--", 0],["19",2019],["20",2020],["21",2021],["22",2022],["23",2023],["24",2024],["25",2025],["26",2026],["27",2027],["28",2028],["29",2029]],{} , class: 'input-expire'
              %span 年
            .input-group
              %label セキュリティコード
              %span.red-box 必須
              =f.text_field:cvc, placeholder: "カード背面４桁もしくは３桁の番号", class: "input-def"
        .reg-container__main--content-title--bottom
          .input-group.right-info
            %p.info-message--right
              = link_to "https://www.mercari.com/jp/privacy/" do
                %i.fas.fa-question-circle
                カードの裏面の番号とは？
          .input-group
            =f.submit "登録する", class:"submit-btn.btn-def", id:"token_submit"
  .reg-container__footer
    %nav
      %ul.clearfix
        %li
          =link_to 'https://www.mercari.com/jp/privacy/' do
            %p プライバシーポリシー
        %li
          =link_to 'https://www.mercari.com/jp/tos/' do
            %p メルカリ利用規約
        %li
          =link_to 'https://www.mercari.com/jp/tokutei/' do
            %p 特定商取引に関する表記
    =link_to "https://www.mercari.com/jp/", {class: "footer-logo"} do
      =image_tag "//www-mercari-jp.akamaized.net/assets/img/common/common/logo-gray.svg?2098311808", {alt: "mercari", height: "65", width: "80"}
    %p
      %small ©2019 Mercari


:javascript
  document.addEventListener(
  "DOMContentLoaded", (e) => {
    Payjp.setPublicKey(ENV['PAYJ_PUBLIC_KEY']});
    const btn = document.getElementById('token_submit'); //IDがtoken_submitの場合に取得されます
    btn.addEventListener("click", (e) => {//ボタンが押されたときに作動します
      e.preventDefault();//ボタンを一旦無効化します

      //カード情報生成
      const card = {
        number: document.getElementById("card_number").value,
        cvc: document.getElementById("cvc").value,
        exp_month: document.getElementById("exp_month").value,
        exp_year: document.getElementById("exp_year").value
      }; //入力されたデータを取得します。

      //トークン生成
      Payjp.createToken(card, (status, response) => {
        if (status === 200) { //成功した場合
          $("#card_number").removeAttr("name");
          $("#cvc").removeAttr("name");
          $("#exp_month").removeAttr("name");
          $("#exp_year").removeAttr("name"); //カード情報を自分のサーバにpostせず削除します
          $("#card_token").append(
            $('<input type="hidden" name="payjp-token">').val(response.id)
          ); //トークンを送信できるように隠しタグを生成
          document.inputForm.submit();
          alert("登録が完了しました"); //確認用
        } else {
          alert("カード情報が正しくありません。"); //確認用
        }
      });
    });
  },false);